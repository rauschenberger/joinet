<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivariate Elastic Net Regression â€¢ joinet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate Elastic Net Regression">
<meta property="og:description" content="joinet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">joinet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">functions</a>
</li>
<li>
  <a href="../articles/joinet.html">vignette</a>
</li>
<li>
  <a href="../articles/article.html">article</a>
</li>
<li>
  <a href="../articles/script.html">script</a>
</li>
<li>
  <a href="../news/index.html">news</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rauschenberger/joinet">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://cran.r-project.org/package=joinet">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multivariate Elastic Net Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rauschenberger/joinet/blob/master/vignettes/script.Rmd"><code>vignettes/script.Rmd</code></a></small>
      <div class="hidden name"><code>script.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">box</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>,<span class="no">y</span>,<span class="no">w</span><span class="kw">=</span><span class="fl">0.2</span>,<span class="no">h</span><span class="kw">=</span><span class="fl">0.2</span>,<span class="no">labels</span><span class="kw">=</span><span class="st">""</span>,<span class="no">col</span><span class="kw">=</span><span class="st">"black"</span>,<span class="no">turn</span><span class="kw">=</span><span class="fl">FALSE</span>,<span class="no">...</span>){
  <span class="no">xs</span> <span class="kw">&lt;-</span> <span class="no">x</span> + <span class="fl">0.5</span>*<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,-<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>)*<span class="no">w</span>
  <span class="no">ys</span> <span class="kw">&lt;-</span> <span class="no">y</span> + <span class="fl">0.5</span>*<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,-<span class="fl">1</span>)*<span class="no">h</span>
  <span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">xs</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">ys</span>,<span class="kw">border</span><span class="kw">=</span><span class="no">col</span>,<span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">col</span><span class="kw">==</span><span class="st">"grey"</span>,<span class="fl">0.99</span>,<span class="fl">0.99</span>)),<span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="no">...</span>)
  <span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">x</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">labels</span>,<span class="kw">col</span><span class="kw">=</span><span class="no">col</span>,<span class="kw">srt</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">turn</span>,<span class="fl">90</span>,<span class="fl">0</span>))
}

<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_ABS.pdf"</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">4</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">2.5</span>)
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>))
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html">plot.new</a></span>()
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">plot.window</a></span>(<span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">2</span>),<span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.1</span>,<span class="fl">1.1</span>))

<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">0.45</span>; <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fl">0.4</span>; <span class="no">q</span> <span class="kw">&lt;-</span> <span class="fl">0.4</span>
<span class="no">h</span> <span class="kw">&lt;-</span> <span class="no">w</span> <span class="kw">&lt;-</span> <span class="fl">0.4</span>

<span class="no">y0</span> <span class="kw">&lt;-</span> <span class="fl">0.10</span>; <span class="no">y1</span> <span class="kw">&lt;-</span> <span class="fl">0.50</span>; <span class="no">y2</span> <span class="kw">&lt;-</span> <span class="fl">0.90</span>
<span class="no">x0</span> <span class="kw">&lt;-</span> <span class="fl">0.20</span>; <span class="no">x1</span> <span class="kw">&lt;-</span> <span class="fl">1.00</span>; <span class="no">x2</span> <span class="kw">&lt;-</span> <span class="fl">1.80</span>
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">to</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>)

<span class="no">w</span> <span class="kw">&lt;-</span> <span class="fl">0.15</span>
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0.06</span>,<span class="kw">to</span><span class="kw">=</span>-<span class="fl">0.06</span>,<span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">Inf</span>,<span class="fl">4</span>)]
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">5</span>){
  <span class="kw">if</span>(<span class="no">i</span><span class="kw">==</span><span class="fl">4</span>){<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">x1</span>,<span class="no">x2</span>),<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>[<span class="fl">4</span>],<span class="kw">labels</span><span class="kw">=</span><span class="st">"..."</span>,<span class="kw">srt</span><span class="kw">=</span><span class="fl">90</span>,<span class="kw">font</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>);<span class="kw">next</span>}
  <span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span>(<span class="kw">x0</span><span class="kw">=</span><span class="no">x0</span>+<span class="no">p</span>/<span class="fl">2</span>,<span class="kw">x1</span><span class="kw">=</span><span class="no">x1</span>-<span class="no">q</span>/<span class="fl">2</span>-<span class="fl">0.02</span>,<span class="kw">y0</span><span class="kw">=</span><span class="no">y1</span>,<span class="kw">y1</span><span class="kw">=</span><span class="no">y</span>[<span class="no">i</span>],<span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">length</span><span class="kw">=</span><span class="fl">0.1</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"grey"</span>)
  <span class="no">labels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"target"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">i</span><span class="kw">==</span><span class="fl">5</span>,<span class="st">"q"</span>,<span class="no">i</span>))
  <span class="kw">for</span>(<span class="no">j</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">5</span>){
    <span class="kw">if</span>(<span class="no">j</span><span class="kw">==</span><span class="fl">4</span>){<span class="kw">next</span>}
      <span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span>(<span class="kw">x0</span><span class="kw">=</span><span class="no">x1</span>+<span class="no">p</span>/<span class="fl">2</span>,<span class="kw">x1</span><span class="kw">=</span><span class="no">x2</span>-<span class="no">q</span>/<span class="fl">2</span>-<span class="fl">0.02</span>,<span class="kw">y0</span><span class="kw">=</span><span class="no">y</span>[<span class="no">i</span>],<span class="kw">y1</span><span class="kw">=</span><span class="no">y</span>[<span class="no">j</span>]+<span class="no">d</span>[<span class="no">i</span>],<span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">length</span><span class="kw">=</span><span class="fl">0.1</span>,<span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">i</span><span class="kw">==</span><span class="no">j</span>,<span class="st">"grey"</span>,<span class="st">"grey"</span>))
  }
  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">x1</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>[<span class="no">i</span>],<span class="kw">h</span><span class="kw">=</span><span class="fl">0.5</span>*<span class="no">h</span>,<span class="kw">w</span><span class="kw">=</span><span class="no">q</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">labels</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">x2</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>[<span class="no">i</span>],<span class="kw">h</span><span class="kw">=</span><span class="fl">0.5</span>*<span class="no">h</span>,<span class="kw">w</span><span class="kw">=</span><span class="no">q</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">labels</span>)
}
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">x0</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">y1</span>,<span class="kw">h</span><span class="kw">=</span><span class="fl">0.5</span>*<span class="no">h</span>,<span class="kw">w</span><span class="kw">=</span><span class="no">p</span>,<span class="kw">labels</span><span class="kw">=</span><span class="st">"features"</span>)

<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_OUT.pdf"</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">5</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">3</span>)

<span class="no">ellipse</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>,<span class="no">y</span>,<span class="no">text</span><span class="kw">=</span><span class="kw">NULL</span>,<span class="no">a</span><span class="kw">=</span><span class="fl">0.5</span>,<span class="no">b</span><span class="kw">=</span><span class="fl">0.5</span>,<span class="no">border</span><span class="kw">=</span><span class="st">"black"</span>,<span class="no">col</span><span class="kw">=</span><span class="kw">NULL</span>,<span class="no">txt.col</span><span class="kw">=</span><span class="st">"black"</span>,<span class="no">...</span>){
    <span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>),<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">y</span>)))
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">col</span>)){<span class="no">col</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="fl">0.9</span>),<span class="kw">times</span><span class="kw">=</span><span class="no">n</span>)}
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">col</span>)<span class="kw">==</span><span class="fl">1</span>){<span class="no">col</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">col</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">n</span>)}
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>)<span class="kw">==</span><span class="fl">1</span>){<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">x</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">n</span>)}
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">y</span>)<span class="kw">==</span><span class="fl">1</span>){<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">y</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">n</span>)}
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">text</span>)<span class="kw">==</span><span class="fl">1</span>){<span class="no">text</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">text</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">n</span>)}
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">border</span>)<span class="kw">==</span><span class="fl">1</span>){<span class="no">border</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">border</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">n</span>)}
    <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="no">n</span>)){
        <span class="no">angle</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">to</span><span class="kw">=</span><span class="fl">2</span>*<span class="no">pi</span>,<span class="kw">length</span><span class="kw">=</span><span class="fl">100</span>)
        <span class="no">xs</span> <span class="kw">&lt;-</span> <span class="no">x</span>[<span class="no">i</span>] + <span class="no">a</span> * <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(<span class="no">angle</span>)
        <span class="no">ys</span> <span class="kw">&lt;-</span> <span class="no">y</span>[<span class="no">i</span>] + <span class="no">b</span> * <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(<span class="no">angle</span>)
        <span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">xs</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">ys</span>,<span class="kw">col</span><span class="kw">=</span><span class="no">col</span>[<span class="no">i</span>],<span class="kw">border</span><span class="kw">=</span><span class="no">border</span>[<span class="no">i</span>])
        <span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">labels</span><span class="kw">=</span><span class="no">text</span>[<span class="no">i</span>],<span class="kw">x</span><span class="kw">=</span><span class="no">x</span>[<span class="no">i</span>],<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>[<span class="no">i</span>],<span class="kw">col</span><span class="kw">=</span><span class="no">txt.col</span>,<span class="no">...</span>)
    }
}

<span class="no">txt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">txt</span>$<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">x</span>[<span class="no">j</span>])
<span class="no">txt</span>$<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"expression("</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"y["</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">3</span>,<span class="st">"k"</span>,<span class="st">"q"</span>),<span class="st">"]"</span>,<span class="kw">collapse</span><span class="kw">=</span><span class="st">","</span>),<span class="st">")"</span>)))
<span class="no">txt</span>$<span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"expression("</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"beta[j"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">3</span>,<span class="st">"k"</span>,<span class="st">"q"</span>),<span class="st">"]"</span>,<span class="kw">collapse</span><span class="kw">=</span><span class="st">","</span>),<span class="st">")"</span>)))
<span class="no">txt</span>$<span class="no">omega</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"expression("</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"omega[\""</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">3</span>,<span class="st">"k"</span>,<span class="st">"q"</span>),<span class="st">"k\"]"</span>,<span class="kw">collapse</span><span class="kw">=</span><span class="st">","</span>),<span class="st">")"</span>)))
<span class="no">txt</span>$<span class="no">dots</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">cdots</span>)

<span class="no">pos</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">pos</span>$<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="no">pos</span>$<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">7</span>)
<span class="no">pos</span>$<span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="no">pos</span>$<span class="no">x</span>)+(<span class="no">pos</span>$<span class="no">y</span>-<span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="no">pos</span>$<span class="no">x</span>))/<span class="fl">2</span>
<span class="no">pos</span>$<span class="no">omega</span> <span class="kw">&lt;-</span> <span class="fl">5</span>+(<span class="no">pos</span>$<span class="no">y</span>-<span class="fl">5</span>)/<span class="fl">2</span>

<span class="no">a</span> <span class="kw">&lt;-</span> <span class="no">b</span> <span class="kw">&lt;-</span> <span class="fl">0.3</span>
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html">plot.new</a></span>()
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>))
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">plot.window</a></span>(<span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>,<span class="fl">7.5</span>),<span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>,<span class="fl">5.5</span>))

<span class="co"># beta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span>(<span class="kw">x0</span><span class="kw">=</span><span class="fl">4</span>,<span class="kw">y0</span><span class="kw">=</span><span class="fl">5</span>-<span class="no">a</span>,<span class="kw">x1</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">y</span>,<span class="kw">y1</span><span class="kw">=</span><span class="fl">3</span>+<span class="no">a</span>,<span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)
<span class="fu">ellipse</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">beta</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">4</span>,<span class="kw">text</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">beta</span>,<span class="kw">a</span><span class="kw">=</span><span class="fl">0.21</span>,<span class="kw">b</span><span class="kw">=</span><span class="fl">0.21</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"white"</span>,<span class="kw">border</span><span class="kw">=</span><span class="st">"white"</span>,<span class="kw">txt.col</span><span class="kw">=</span><span class="st">"blue"</span>)

<span class="co"># omega</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span>(<span class="kw">x0</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">pos</span>$<span class="no">y</span>,<span class="kw">each</span><span class="kw">=</span><span class="fl">4</span>),<span class="kw">y0</span><span class="kw">=</span><span class="fl">3</span>-<span class="no">a</span>,<span class="kw">x1</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">pos</span>$<span class="no">y</span>,<span class="kw">times</span><span class="kw">=</span><span class="fl">4</span>),<span class="kw">y1</span><span class="kw">=</span><span class="fl">1</span>+<span class="no">a</span>,<span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"grey"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span>(<span class="kw">x0</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">y</span>,<span class="kw">y0</span><span class="kw">=</span><span class="fl">3</span>-<span class="no">a</span>,<span class="kw">y1</span><span class="kw">=</span><span class="fl">1</span>+<span class="no">a</span>,<span class="kw">x1</span><span class="kw">=</span><span class="fl">5</span>,<span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>)
<span class="fu">ellipse</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">omega</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">text</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">omega</span>,<span class="kw">a</span><span class="kw">=</span><span class="fl">0.25</span>,<span class="kw">b</span><span class="kw">=</span><span class="fl">0.18</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"white"</span>,<span class="kw">border</span><span class="kw">=</span><span class="st">"white"</span>,<span class="kw">txt.col</span><span class="kw">=</span><span class="st">"red"</span>)

<span class="co"># x and y</span>
<span class="fu">ellipse</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">x</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">5</span>,<span class="kw">text</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">x</span>,<span class="kw">a</span><span class="kw">=</span><span class="no">a</span>,<span class="kw">b</span><span class="kw">=</span><span class="no">b</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">5</span>),<span class="kw">y</span><span class="kw">=</span><span class="fl">5</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">dots</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>)
<span class="fu">ellipse</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">y</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">text</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">y</span>,<span class="kw">a</span><span class="kw">=</span><span class="no">a</span>,<span class="kw">b</span><span class="kw">=</span><span class="no">b</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">6</span>),<span class="kw">y</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">dots</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>)
<span class="fu">ellipse</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pos</span>$<span class="no">y</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">text</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">y</span>,<span class="kw">a</span><span class="kw">=</span><span class="no">a</span>,<span class="kw">b</span><span class="kw">=</span><span class="no">b</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">6</span>),<span class="kw">y</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">txt</span>$<span class="no">dots</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">1.2</span>)

<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h1>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">#&lt;&lt;start&gt;&gt;</span>

<span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">grid</span>$<span class="no">rho_x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.00</span>,<span class="fl">0.10</span>,<span class="fl">0.30</span>)
<span class="no">grid</span>$<span class="no">rho_b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.00</span>,<span class="fl">0.50</span>,<span class="fl">0.90</span>)
<span class="no">delta</span> <span class="kw">&lt;-</span> <span class="fl">0.8</span>
<span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="no">grid</span>)
<span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">grid</span>,<span class="no">grid</span>,<span class="no">grid</span>)
<span class="no">grid</span>$<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>,<span class="fl">500</span>,<span class="fl">500</span>),<span class="kw">each</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">grid</span>)/<span class="fl">3</span>)
<span class="no">grid</span>$<span class="no">nzero</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">100</span>),<span class="kw">each</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">grid</span>)/<span class="fl">3</span>)
<span class="no">grid</span> <span class="kw">&lt;-</span> <span class="no">grid</span>[<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">grid</span>),<span class="kw">times</span><span class="kw">=</span><span class="fl">10</span>),]

<span class="no">n0</span> <span class="kw">&lt;-</span> <span class="fl">100</span>; <span class="no">n1</span> <span class="kw">&lt;-</span> <span class="fl">10000</span>
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="no">n0</span> + <span class="no">n1</span>
<span class="no">q</span> <span class="kw">&lt;-</span> <span class="fl">3</span>
<span class="no">foldid.ext</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>),<span class="kw">times</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">n0</span>,<span class="no">n1</span>))

<span class="no">loss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(); <span class="no">cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>()
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">grid</span>))){
  <span class="no">p</span> <span class="kw">&lt;-</span> <span class="no">grid</span>$<span class="no">p</span>[<span class="no">i</span>]
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="no">i</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"i ="</span>,<span class="no">i</span>,<span class="st">"\n"</span>)

  <span class="co">#--- features ---</span>
  <span class="no">mean</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">p</span>)
  <span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">grid</span>$<span class="no">rho_x</span>[<span class="no">i</span>],<span class="kw">nrow</span><span class="kw">=</span><span class="no">p</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="no">p</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">sigma</span>) <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="no">X</span> <span class="kw">&lt;-</span> <span class="kw pkg">mvtnorm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html">rmvnorm</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="no">n</span>,<span class="kw">mean</span><span class="kw">=</span><span class="no">mean</span>,<span class="kw">sigma</span><span class="kw">=</span><span class="no">sigma</span>)

  <span class="co">#--- effects --- (multivariate Gaussian)</span>
  <span class="no">mean</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="kw">times</span><span class="kw">=</span><span class="no">q</span>)
  <span class="no">sigma</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">grid</span>$<span class="no">rho_b</span>[<span class="no">i</span>],<span class="kw">nrow</span><span class="kw">=</span><span class="no">q</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="no">q</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">sigma</span>) <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="no">beta</span> <span class="kw">&lt;-</span> <span class="kw pkg">mvtnorm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html">rmvnorm</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="no">p</span>,<span class="kw">mean</span><span class="kw">=</span><span class="no">mean</span>,<span class="kw">sigma</span><span class="kw">=</span><span class="no">sigma</span>)
  <span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fl">1</span>*<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">beta</span>,<span class="fl">2</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span><span class="kw">&gt;</span>(<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">x</span>,<span class="kw">decreasing</span><span class="kw">=</span><span class="fl">TRUE</span>)[<span class="no">grid</span>$<span class="no">nzero</span>[<span class="no">i</span>]]))

  <span class="co">#-- effects --- (multivariate binomial)</span>
  <span class="co">#sigma &lt;- matrix(grid$rho_b[i],nrow=q,ncol=q); diag(sigma) &lt;- 1</span>
  <span class="co">#beta &lt;- bindata::rmvbin(n=p,margprob=rep(grid$prop[i],times=q),bincorr=sigma)</span>

  <span class="co">#--- outcomes ---</span>
  <span class="no">signal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">X</span><span class="kw">%*%</span><span class="no">beta</span>)
  <span class="no">signal</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">signal</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
  <span class="no">noise</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>*<span class="no">q</span>),<span class="kw">nrow</span><span class="kw">=</span><span class="no">n</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="no">q</span>)
  <span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">delta</span>)*<span class="no">signal</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fl">1</span>-<span class="no">delta</span>)*<span class="no">noise</span>
  <span class="co"># binomial: Y &lt;- round(exp(Y)/(1+exp(Y)))</span>
  <span class="no">cors</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">Y</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">cors</span>) <span class="kw">&lt;-</span> <span class="fl">NA</span>
  <span class="no">cor</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">cors</span>,<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)

  <span class="co">#--- holdout ---</span>
  <span class="no">alpha.base</span> <span class="kw">&lt;-</span> <span class="fl">1</span>*(<span class="no">grid</span>$<span class="no">nzero</span>[<span class="no">i</span>] <span class="kw">&lt;=</span> <span class="fl">10</span>) <span class="co"># sparse vs dense</span>
  <span class="no">compare</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
  <span class="no">loss</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(<span class="kw">expr</span><span class="kw">=</span><span class="fu"><a href="../reference/cv.joinet.html">cv.joinet</a></span>(<span class="kw">Y</span><span class="kw">=</span><span class="no">Y</span>,<span class="kw">X</span><span class="kw">=</span><span class="no">X</span>,<span class="kw">family</span><span class="kw">=</span><span class="st">"gaussian"</span>,<span class="kw">compare</span><span class="kw">=</span><span class="no">compare</span>,<span class="kw">foldid.ext</span><span class="kw">=</span><span class="no">foldid.ext</span>,<span class="kw">alpha.base</span><span class="kw">=</span><span class="no">alpha.base</span>,<span class="kw">alpha.meta</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">times</span><span class="kw">=</span><span class="fl">TRUE</span>),<span class="kw">error</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>) <span class="fl">NA</span>)
}
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">grid</span>,<span class="no">loss</span>,<span class="no">cor</span>,<span class="kw">file</span><span class="kw">=</span><span class="st">"results/simulation.RData"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span>(<span class="kw pkg">utils</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>(),<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n"</span>),<span class="kw pkg">sessioninfo</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span>()),<span class="kw">con</span><span class="kw">=</span><span class="st">"results/info_sim.txt"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#&lt;&lt;start&gt;&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/simulation.RData"</span>)

<span class="no">cond</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">loss</span>,<span class="no">length</span>)<span class="kw">==</span><span class="fl">2</span>
<span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(!<span class="no">cond</span>)){
  <span class="fu"><a href="https://rdrr.io/r/base/warning.html">warning</a></span>(<span class="st">"At least one error."</span>,<span class="kw">call.</span><span class="kw">=</span><span class="fl">FALSE</span>)
  <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="no">grid</span>[<span class="no">cond</span>,]; <span class="no">loss</span> <span class="kw">&lt;-</span> <span class="no">loss</span>[<span class="no">cond</span>]
}

<span class="co">#--- computation time ---</span>
<span class="no">time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>$<span class="no">time</span>))
<span class="co">#round(sort(colMeans(apply(time,1,function(x) x/time["meta",]))),digits=1)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">time</span>),<span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>))

<span class="co">#--- average ---</span>
<span class="no">loss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">loss</span>)
<span class="no">prop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>[<span class="no">cond</span>],<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fl">100</span>*<span class="no">x</span>/<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">x</span>[<span class="st">"none"</span>,],<span class="kw">nrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">x</span>),<span class="kw">ncol</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">x</span>),<span class="kw">byrow</span><span class="kw">=</span><span class="fl">TRUE</span>))[-<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">x</span>)])
<span class="no">mode</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">grid</span>$<span class="no">p</span><span class="kw">==</span><span class="fl">10</span>,<span class="st">"ld"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">grid</span>$<span class="no">nzero</span><span class="kw">==</span><span class="fl">5</span>,<span class="st">"hd-s"</span>,<span class="st">"hd-d"</span>))
<span class="no">set</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">grid</span>),<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">x</span>,<span class="kw">split</span><span class="kw">=</span><span class="st">"\\."</span>)<span class="kw">[[</span><span class="fl">1</span>]]<span class="kw">[[</span><span class="fl">1</span>]]))

<span class="co">#--- mean rank ---</span>
<span class="no">mult</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">prop</span>)<span class="kw">!=</span><span class="st">"base"</span>
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">prop</span>[<span class="no">mult</span>,<span class="no">mode</span><span class="kw">==</span><span class="st">"ld"</span>],<span class="fl">2</span>,<span class="no">rank</span>)),<span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">prop</span>[<span class="no">mult</span>,<span class="no">mode</span><span class="kw">==</span><span class="st">"hd-s"</span>],<span class="fl">2</span>,<span class="no">rank</span>)),<span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">prop</span>[<span class="no">mult</span>,<span class="no">mode</span><span class="kw">==</span><span class="st">"hd-d"</span>],<span class="fl">2</span>,<span class="no">rank</span>)),<span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>))

<span class="co">#--- testing ---</span>
<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">prop</span>[<span class="no">mult</span>,],<span class="fl">1</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="no">x</span>-<span class="no">prop</span>[<span class="st">"base"</span>,],<span class="kw">INDEX</span><span class="kw">=</span><span class="no">set</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span>(<span class="no">x</span>,<span class="kw">alternative</span><span class="kw">=</span><span class="st">"less"</span>)$<span class="no">p.value</span><span class="kw">&lt;</span><span class="fl">0.05</span>),<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>))

<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="no">prop</span>[<span class="st">"meta"</span>,]-<span class="no">prop</span>[<span class="st">"base"</span>,],<span class="kw">INDEX</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">set</span><span class="kw">=</span><span class="no">set</span>,<span class="kw">mode</span><span class="kw">=</span><span class="no">mode</span>),<span class="kw">FUN</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span>(<span class="no">x</span>,<span class="kw">alternative</span><span class="kw">=</span><span class="st">"less"</span>)$<span class="no">p.value</span><span class="kw">&lt;</span><span class="fl">0.05</span>),<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="no">prop</span>[<span class="st">"spls"</span>,]-<span class="no">prop</span>[<span class="st">"base"</span>,],<span class="kw">INDEX</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">set</span><span class="kw">=</span><span class="no">set</span>,<span class="kw">mode</span><span class="kw">=</span><span class="no">mode</span>),<span class="kw">FUN</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span>(<span class="no">x</span>,<span class="kw">alternative</span><span class="kw">=</span><span class="st">"less"</span>)$<span class="no">p.value</span><span class="kw">&lt;</span><span class="fl">0.05</span>),<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">set</span>),<span class="kw">function</span>(<span class="no">i</span>) <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">prop</span>[,<span class="no">set</span><span class="kw">==</span><span class="no">i</span>]))
<span class="no">cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">set</span>),<span class="kw">function</span>(<span class="no">i</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">cor</span>[<span class="no">set</span><span class="kw">==</span><span class="no">i</span>]))

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">beta</span>)[<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">beta</span>)<span class="kw">==</span><span class="st">"mnorm"</span>] <span class="kw">&lt;-</span> <span class="st">"mvn"</span>
<span class="no">sign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">beta</span>,<span class="fl">2</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span>(<span class="no">x</span>[<span class="st">"base"</span>]-<span class="no">x</span>))
<span class="no">min</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">beta</span>,<span class="fl">2</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="no">x</span>))
<span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">beta</span>,<span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>),<span class="kw">trim</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="no">beta</span>[<span class="no">sign</span><span class="kw">&lt;=</span><span class="fl">0</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"\\textcolor{gray}{"</span>,<span class="no">beta</span>[<span class="no">sign</span><span class="kw">&lt;=</span><span class="fl">0</span>],<span class="st">"}"</span>)
<span class="no">index</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">min</span>,<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">beta</span>))
<span class="no">beta</span>[<span class="no">index</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"\\underline{"</span>,<span class="no">beta</span>[<span class="no">index</span>],<span class="st">"}"</span>)
<span class="no">unique</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">grid</span>)
<span class="no">info</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="st">"$\\rho_x$"</span><span class="kw">=</span><span class="no">unique</span>$<span class="no">rho_x</span>,<span class="st">"$\\rho_b$"</span><span class="kw">=</span><span class="no">unique</span>$<span class="no">rho_b</span>,<span class="st">"$\\rho_y$"</span><span class="kw">=</span><span class="no">cor</span>),<span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>))
<span class="no">temp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"\\cran{"</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">beta</span>),<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/switch.html">switch</a></span>(<span class="no">x</span>,<span class="kw">base</span><span class="kw">=</span><span class="st">"glmnet"</span>,<span class="kw">meta</span><span class="kw">=</span><span class="st">"joinet"</span>,<span class="kw">mvn</span><span class="kw">=</span><span class="st">"glmnet"</span>,<span class="kw">mars</span><span class="kw">=</span><span class="st">"earth"</span>,<span class="kw">spls</span><span class="kw">=</span><span class="st">"spls"</span>,<span class="kw">mrce</span><span class="kw">=</span><span class="st">"MRCE"</span>,<span class="kw">map</span><span class="kw">=</span><span class="st">"remMap"</span>,<span class="kw">mrf</span><span class="kw">=</span><span class="st">"MultivariateRandomForest"</span>,<span class="kw">sier</span><span class="kw">=</span><span class="st">"SiER"</span>,<span class="kw">mcen</span><span class="kw">=</span><span class="st">"mcen"</span>,<span class="kw">gpm</span><span class="kw">=</span><span class="st">"GPM"</span>,<span class="kw">rmtl</span><span class="kw">=</span><span class="st">"RMTL"</span>,<span class="kw">mtps</span><span class="kw">=</span><span class="st">"MTPS"</span>,<span class="kw">NULL</span>)),<span class="st">"}"</span>)
<span class="no">temp</span>[<span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">temp</span>[<span class="fl">1</span>],<span class="st">"$^1$"</span>)
<span class="no">temp</span>[<span class="fl">3</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">temp</span>[<span class="fl">3</span>],<span class="st">"$^2$"</span>)
<span class="no">temp</span>[<span class="fl">8</span>] <span class="kw">&lt;-</span> <span class="st">"\\href{https://CRAN.R-project.org/package=MultivariateRandomForest}{\\texttt{MRF}}$^3$"</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">beta</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"\\begin{sideways}"</span>,<span class="no">temp</span>,<span class="st">"\\end{sideways}"</span>)
<span class="no">xtable</span> <span class="kw">&lt;-</span> <span class="kw pkg">xtable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/xtable/man/xtable.html">xtable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">info</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">beta</span>)),<span class="kw">align</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"rccc"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"c"</span>,<span class="kw">times</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">beta</span>)),<span class="kw">collapse</span><span class="kw">=</span><span class="st">""</span>),<span class="kw">collapse</span><span class="kw">=</span><span class="st">""</span>),<span class="kw">caption</span><span class="kw">=</span><span class="st">"Mean loss of different models (as percentage of empty model) in low-dimensional (top), sparse high-dimensional (centre), and dense high-dimensional (bottom) settings. The first three columns indicate the correlation between inputs ($\\rho_x$), the correlation between effects ($\\rho_b$), and the resulting mean correlation between outputs ($\\rho_y$). For each setting, the colour black indicates which models are more predictive than univariate regression, and the underline indicates the most predictive model. $\\hfill$ \\footnotesize$^1$univariate and $^2$multivariate linear regression with \\cran{glmnet}, $^3$\\cran{MultivariateRandomForest}\\normalsize\\label{table_SIM}"</span>)
<span class="kw pkg">xtable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/xtable/man/print.xtable.html">print.xtable</a></span>(<span class="no">xtable</span>,<span class="kw">comment</span><span class="kw">=</span><span class="fl">FALSE</span>,<span class="kw">floating</span><span class="kw">=</span><span class="fl">TRUE</span>,<span class="kw">sanitize.text.function</span><span class="kw">=</span><span class="no">identity</span>,<span class="kw">hline.after</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">9</span>,<span class="fl">18</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">beta</span>)),<span class="kw">include.rownames</span><span class="kw">=</span><span class="fl">FALSE</span>,<span class="kw">size</span><span class="kw">=</span><span class="st">"\\footnotesize"</span>,<span class="kw">caption.placement</span><span class="kw">=</span><span class="st">"top"</span>)</pre></body></html></div>
</div>
<div id="application" class="section level1">
<h1 class="hasAnchor">
<a href="#application" class="anchor"></a>Application</h1>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># clinical features</span>
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"data/PPMI_Baseline_Data_02Jul2018.csv"</span>,<span class="kw">row.names</span><span class="kw">=</span><span class="st">"PATNO"</span>,<span class="kw">na.strings</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"."</span>,<span class="st">""</span>))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">X</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">X</span>))
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="no">X</span>[<span class="no">X</span>$<span class="no">apprdx</span><span class="kw">==</span><span class="fl">1</span>,] <span class="co"># Parkinson's disease</span>
<span class="no">X</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"site"</span>,<span class="st">"apprdx"</span>,<span class="st">"event_id"</span>,<span class="st">"symptom5_comment"</span>)] <span class="kw">&lt;-</span> <span class="kw">NULL</span>
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">X</span>))){
  <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">is.factor</a></span>(<span class="no">X</span><span class="kw">[[</span><span class="no">i</span>]])){<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">X</span><span class="kw">[[</span><span class="no">i</span>]]) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">X</span><span class="kw">[[</span><span class="no">i</span>]]))}
}
<span class="fl">100</span>*<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">X</span>)) <span class="co"># proportion missingness</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fl">1</span>),<span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">missRanger</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/missRanger/man/missRanger.html">missRanger</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">X</span>,<span class="kw">pmm.k</span><span class="kw">=</span><span class="fl">3</span>,
        <span class="kw">num.trees</span><span class="kw">=</span><span class="fl">100</span>,<span class="kw">verbose</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">seed</span><span class="kw">=</span><span class="fl">1</span>)) <span class="co"># impute multiple times!</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">x</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(~<span class="no">.</span>-<span class="fl">1</span>,<span class="kw">data</span><span class="kw">=</span><span class="no">x</span>))
<span class="co">#X &lt;- x[[1]] # impute multiple times</span>

<span class="co"># genomic features</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"data/ppmi_rnaseq_bl_pd_hc-2019-01-11.Rdata"</span>,<span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="no">counts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">ppmi_rnaseq_bl_pdhc</span>)
<span class="no">cond</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">counts</span>,<span class="fl">2</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">x</span>)<span class="kw">&gt;</span><span class="fl">0</span>) <span class="kw">&amp;</span> !<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="kw">pattern</span><span class="kw">=</span><span class="st">"ENSG0000|ENSGR0000"</span>,<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">counts</span>))
<span class="no">Z</span> <span class="kw">&lt;-</span> <span class="kw pkg">palasso</span><span class="kw ns">:::</span><span class="fu"><a href="https://rdrr.io/pkg/palasso/man/other.html">.prepare</a></span>(<span class="no">counts</span>[,<span class="no">cond</span>],<span class="kw">filter</span><span class="kw">=</span><span class="fl">10</span>,<span class="kw">cutoff</span><span class="kw">=</span><span class="st">"knee"</span>)$<span class="no">X</span>

<span class="co"># outcome</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"data/PPMI_Year_1-3_Data_02Jul2018.csv"</span>,<span class="kw">na.strings</span><span class="kw">=</span><span class="st">"."</span>)
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="no">Y</span>[<span class="no">Y</span>$<span class="no">APPRDX</span><span class="kw">==</span><span class="fl">1</span> <span class="kw">&amp;</span> <span class="no">Y</span>$<span class="no">EVENT_ID</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V04"</span>,<span class="st">"V06"</span>,<span class="st">"V08"</span>),]
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">Y</span>)[<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">Y</span>)<span class="kw">==</span><span class="st">"updrs_totscore"</span>] <span class="kw">&lt;-</span> <span class="st">"updrs"</span>
<span class="no">vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"moca"</span>,<span class="st">"quip"</span>,<span class="st">"updrs"</span>,<span class="st">"gds"</span>,<span class="st">"scopa"</span>,<span class="st">"ess"</span>,<span class="st">"bjlot"</span>,<span class="st">"rem"</span>)
<span class="co"># too few levels: "NP1HALL","NP1DPRS"</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="no">Y</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"EVENT_ID"</span>,<span class="st">"PATNO"</span>,<span class="no">vars</span>)]
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span>(<span class="no">Y</span>,<span class="kw">idvar</span><span class="kw">=</span><span class="st">"PATNO"</span>,<span class="kw">timevar</span><span class="kw">=</span><span class="st">"EVENT_ID"</span>,<span class="kw">direction</span><span class="kw">=</span><span class="st">"wide"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">Y</span>) <span class="kw">&lt;-</span> <span class="no">Y</span>$<span class="no">PATNO</span>; <span class="no">Y</span>$<span class="no">PATNO</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>

<span class="co"># overlap</span>
<span class="no">names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span>(<span class="no">intersect</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">X</span>),<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">Y</span>),<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">Z</span>)))
<span class="no">Z</span> <span class="kw">&lt;-</span> <span class="no">Z</span>[<span class="no">names</span>,]
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="no">Y</span>[<span class="no">names</span>,]
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">vars</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">Y</span>[,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="kw">pattern</span><span class="kw">=</span><span class="no">x</span>,<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">Y</span>))],<span class="kw">simplify</span><span class="kw">=</span><span class="fl">FALSE</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">Y</span>)){
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">Y</span><span class="kw">[[</span><span class="no">i</span>]]) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V04"</span>,<span class="st">"V06"</span>,<span class="st">"V08"</span>)
}
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">x</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>[<span class="no">names</span>,]); <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">names</span>)
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="no">x</span><span class="kw">[[</span><span class="fl">1</span>]]; <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">x</span>) <span class="co"># impute multiple times!</span>

<span class="co"># inversion for positive correlation</span>
<span class="no">Y</span>$<span class="no">moca</span> <span class="kw">&lt;-</span> -<span class="no">Y</span>$<span class="no">moca</span> <span class="co"># "wrong" sign</span>
<span class="no">Y</span>$<span class="no">bjlot</span> <span class="kw">&lt;-</span> -<span class="no">Y</span>$<span class="no">bjlot</span> <span class="co"># "wrong" sign</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>),<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>))

<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">Y</span>,<span class="no">X</span>,<span class="no">Z</span>,<span class="kw">file</span><span class="kw">=</span><span class="st">"results/data.RData"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span>(<span class="kw pkg">utils</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>(),<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n"</span>),<span class="kw pkg">sessioninfo</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span>()),<span class="kw">con</span><span class="kw">=</span><span class="st">"results/info_dat.txt"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/data.RData"</span>,<span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>)

<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_COR.pdf"</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">6</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">3</span>)
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">0.5</span>))
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span>(<span class="kw">mat</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>),<span class="kw">nrow</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="fl">2</span>),<span class="kw">width</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>,<span class="fl">0.8</span>))

<span class="co"># correlation between years</span>
<span class="no">cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">x</span>[,<span class="fl">1</span>],<span class="no">x</span>[,<span class="fl">2</span>],<span class="kw">use</span><span class="kw">=</span><span class="st">"complete.obs"</span>,<span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)),
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">x</span>[,<span class="fl">2</span>],<span class="no">x</span>[,<span class="fl">3</span>],<span class="kw">use</span><span class="kw">=</span><span class="st">"complete.obs"</span>,<span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)),
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">x</span>[,<span class="fl">1</span>],<span class="no">x</span>[,<span class="fl">3</span>],<span class="kw">use</span><span class="kw">=</span><span class="st">"complete.obs"</span>,<span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">cor</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1-2"</span>,<span class="st">"2-3"</span>,<span class="st">"1-3"</span>)
<span class="no">cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">cor</span>)
<span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="no">cor</span>,<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>,<span class="fl">3</span>),<span class="kw">margin</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.7</span>)

<span class="co"># correlation between variables</span>
<span class="no">cor</span> <span class="kw">&lt;-</span> <span class="fl">1</span>/<span class="fl">3</span>*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>[,<span class="fl">1</span>]),<span class="kw">use</span><span class="kw">=</span><span class="st">"complete.obs"</span>,<span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)+
<span class="fl">1</span>/<span class="fl">3</span>*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>[,<span class="fl">2</span>]),<span class="kw">use</span><span class="kw">=</span><span class="st">"complete.obs"</span>,<span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)+
<span class="fl">1</span>/<span class="fl">3</span>*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>[,<span class="fl">3</span>]),<span class="kw">use</span><span class="kw">=</span><span class="st">"complete.obs"</span>,<span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)
<span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="no">cor</span>,<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>,<span class="fl">3</span>),<span class="kw">margin</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>),<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.7</span>)
<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()

<span class="co"># other information</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="no">colMeans</span>,<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>) <span class="co"># increasing values</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">x</span>,<span class="fl">2</span>,<span class="no">sd</span>,<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)) <span class="co"># increasing variance</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Y</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>))) <span class="co"># increasing numbers of NAs</span></pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">#&lt;&lt;start&gt;&gt;</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/data.RData"</span>,<span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">foldid.ext</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fl">5</span>,<span class="kw">length.out</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Y</span>$<span class="no">moca</span>))
<span class="no">foldid.int</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fl">10</span>,<span class="kw">each</span><span class="kw">=</span><span class="fl">5</span>),<span class="kw">length.out</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Y</span>$<span class="no">moca</span>))
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">foldid.ext</span>,<span class="no">foldid.int</span>)

<span class="co">#- - - - - - - - - - - - -</span>
<span class="co">#- - internal coaching - -</span>
<span class="co">#- - - - - - - - - - - - -</span>

<span class="no">table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">table</span>$<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lasso"</span>,<span class="st">"ridge"</span>)
<span class="no">table</span>$<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"clinic"</span>,<span class="st">"omics"</span>,<span class="st">"both"</span>)
<span class="no">table</span>$<span class="no">var</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">Y</span>)
<span class="no">table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="no">table</span>,<span class="kw">stringsAsFactors</span><span class="kw">=</span><span class="fl">FALSE</span>))

<span class="no">loss</span> <span class="kw">&lt;-</span> <span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">table</span>))){
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"*"</span>,<span class="kw">times</span><span class="kw">=</span><span class="fl">5</span>),<span class="st">"setting"</span>,<span class="no">i</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"*"</span>,<span class="kw">times</span><span class="kw">=</span><span class="fl">5</span>),<span class="st">"\n"</span>)
  <span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">Y</span><span class="kw">[[</span><span class="no">table</span>$<span class="no">var</span>[<span class="no">i</span>]]]
  <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">clinic</span><span class="kw">=</span><span class="no">X</span>,<span class="kw">omics</span><span class="kw">=</span><span class="no">Z</span>,<span class="kw">both</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">X</span>,<span class="no">Z</span>))<span class="kw">[[</span><span class="no">table</span>$<span class="no">data</span>[<span class="no">i</span>]]]
  <span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fl">1</span>*(<span class="no">table</span>$<span class="no">alpha</span>[<span class="no">i</span>]<span class="kw">==</span><span class="st">"lasso"</span>)
  <span class="no">loss</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cv.joinet.html">cv.joinet</a></span>(<span class="kw">Y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">X</span><span class="kw">=</span><span class="no">x</span>,<span class="kw">alpha.base</span><span class="kw">=</span><span class="no">alpha</span>,<span class="kw">foldid.ext</span><span class="kw">=</span><span class="no">foldid.ext</span>,
          <span class="kw">foldid.int</span><span class="kw">=</span><span class="no">foldid.int</span>) <span class="co"># add joinet::</span>
  <span class="co">#fit[[i]] &lt;- joinet(Y=y,X=x,alpha.base=alpha,foldid=foldid.int)</span>
}

<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">table</span>,<span class="no">loss</span>,<span class="kw">file</span><span class="kw">=</span><span class="st">"results/internal.RData"</span>)

<span class="co">#- - - - - - - - - - - - -</span>
<span class="co">#- - external coaching - -</span>
<span class="co">#- - - - - - - - - - - - -</span>

<span class="no">table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">temp</span> <span class="kw">&lt;-</span> <span class="kw pkg">utils</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/utils/combn.html">combn</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">Y</span>),<span class="kw">m</span><span class="kw">=</span><span class="fl">2</span>)
<span class="no">table</span>$<span class="no">comb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">temp</span>[<span class="fl">1</span>,],<span class="st">"-"</span>,<span class="no">temp</span>[<span class="fl">2</span>,])
<span class="no">table</span>$<span class="no">step</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V04"</span>,<span class="st">"V06"</span>,<span class="st">"V08"</span>)
<span class="no">table</span>$<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lasso"</span>,<span class="st">"ridge"</span>)
<span class="no">table</span>$<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"clinic"</span>,<span class="st">"omics"</span>,<span class="st">"both"</span>)
<span class="no">table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="no">table</span>,<span class="kw">stringsAsFactors</span><span class="kw">=</span><span class="fl">FALSE</span>))
<span class="no">temp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">table</span>$<span class="no">comb</span>,<span class="kw">split</span><span class="kw">=</span><span class="st">"-"</span>); <span class="no">table</span>$<span class="no">comb</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>
<span class="no">table</span>$<span class="no">var1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">temp</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span><span class="kw">[[</span><span class="fl">1</span>]])
<span class="no">table</span>$<span class="no">var2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">temp</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span><span class="kw">[[</span><span class="fl">2</span>]])

<span class="no">loss</span> <span class="kw">&lt;-</span> <span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">table</span>))){
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"*"</span>,<span class="kw">times</span><span class="kw">=</span><span class="fl">5</span>),<span class="st">"setting"</span>,<span class="no">i</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"*"</span>,<span class="kw">times</span><span class="kw">=</span><span class="fl">5</span>),<span class="st">"\n"</span>)
  <span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">Y</span><span class="kw">[[</span><span class="no">table</span>$<span class="no">var1</span>[<span class="no">i</span>]]][,<span class="no">table</span>$<span class="no">step</span>[<span class="no">i</span>]],
             <span class="no">Y</span><span class="kw">[[</span><span class="no">table</span>$<span class="no">var2</span>[<span class="no">i</span>]]][,<span class="no">table</span>$<span class="no">step</span>[<span class="no">i</span>]])
  <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">clinic</span><span class="kw">=</span><span class="no">X</span>,<span class="kw">omics</span><span class="kw">=</span><span class="no">Z</span>,<span class="kw">both</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">X</span>,<span class="no">Z</span>))<span class="kw">[[</span><span class="no">table</span>$<span class="no">data</span>[<span class="no">i</span>]]]
  <span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fl">1</span>*(<span class="no">table</span>$<span class="no">alpha</span>[<span class="no">i</span>]<span class="kw">==</span><span class="st">"lasso"</span>)
  <span class="no">loss</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cv.joinet.html">cv.joinet</a></span>(<span class="kw">Y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">X</span><span class="kw">=</span><span class="no">x</span>,<span class="kw">alpha.base</span><span class="kw">=</span><span class="no">alpha</span>,
                <span class="kw">foldid.ext</span><span class="kw">=</span><span class="no">foldid.ext</span>,<span class="kw">foldid.int</span><span class="kw">=</span><span class="no">foldid.int</span>) <span class="co"># add joinet::</span>
  <span class="co">#fit[[i]] &lt;- joinet(Y=y,X=x,alpha.base=alpha,foldid=foldid.int)</span>
}

<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">table</span>,<span class="no">loss</span>,<span class="kw">file</span><span class="kw">=</span><span class="st">"results/external.RData"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span>(<span class="kw pkg">utils</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>(),<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n"</span>),<span class="kw pkg">sessioninfo</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span>()),<span class="kw">con</span><span class="kw">=</span><span class="st">"results/info_app.txt"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/internal.RData"</span>)

<span class="co"># standardised loss</span>
<span class="no">vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">table</span>$<span class="no">var</span>)
<span class="no">former</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>[<span class="st">"base"</span>,]))
<span class="no">min</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">vars</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">former</span>[<span class="no">table</span>$<span class="no">var</span><span class="kw">==</span><span class="no">x</span>,]))
<span class="no">max</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">vars</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">former</span>[<span class="no">table</span>$<span class="no">var</span><span class="kw">==</span><span class="no">x</span>,]))
<span class="no">index</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">table</span>$<span class="no">var</span>,<span class="kw">table</span><span class="kw">=</span><span class="no">vars</span>)
<span class="no">former</span> <span class="kw">&lt;-</span> (<span class="no">former</span>-<span class="no">min</span>[<span class="no">index</span>])/(<span class="no">max</span>[<span class="no">index</span>]-<span class="no">min</span>[<span class="no">index</span>])
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">former</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">table</span>$<span class="no">var</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fl">3</span>))

<span class="co"># percentage change</span>
<span class="no">change</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"meta"</span>,]-<span class="no">x</span>[<span class="st">"base"</span>,])/<span class="no">x</span>[<span class="st">"base"</span>,]))
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">change</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">table</span>$<span class="no">var</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1st"</span>,<span class="st">"2nd"</span>,<span class="st">"3rd"</span>))

<span class="co"># overview</span>
<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_INT.pdf"</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">6</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">pointsize</span><span class="kw">=</span><span class="fl">12</span>)
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>),<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">0.1</span>),<span class="kw">oma</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1.1</span>,<span class="fl">1</span>,<span class="fl">0</span>))
<span class="kw">for</span>(<span class="no">alpha</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lasso"</span>,<span class="st">"ridge"</span>)){
  <span class="kw">for</span>(<span class="no">data</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"clinic"</span>,<span class="st">"omics"</span>,<span class="st">"both"</span>)){
    <span class="no">cond</span> <span class="kw">&lt;-</span> <span class="no">table</span>$<span class="no">alpha</span><span class="kw">==</span><span class="no">alpha</span> <span class="kw">&amp;</span> <span class="no">table</span>$<span class="no">data</span><span class="kw">==</span><span class="no">data</span>
    <span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="kw">X</span><span class="kw">=</span><span class="no">change</span>[<span class="no">cond</span>,],<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">50</span>,<span class="fl">50</span>),<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.7</span>)
    <span class="co">#graphics::title(main=paste0(alpha,"-",data),col.main="red",line=0) # check</span>
    <span class="kw">if</span>(<span class="no">alpha</span><span class="kw">==</span><span class="st">"lasso"</span>){<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="no">data</span>,<span class="kw">side</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">line</span><span class="kw">=</span><span class="fl">1.5</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.8</span>)}
    <span class="kw">if</span>(<span class="no">data</span><span class="kw">==</span><span class="st">"clinic"</span>){<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="no">alpha</span>,<span class="kw">side</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">line</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.8</span>)}
  }
}
<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()

<span class="no">TEMP</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">change</span>),<span class="kw">INDEX</span><span class="kw">=</span><span class="no">table</span>$<span class="no">var</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="no">mean</span>)[<span class="no">vars</span>]
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">change</span><span class="kw">&lt;</span><span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">change</span>),<span class="kw">INDEX</span><span class="kw">=</span><span class="no">table</span>$<span class="no">data</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="no">mean</span>),<span class="kw">digits</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">change</span>),<span class="kw">INDEX</span><span class="kw">=</span><span class="no">table</span>$<span class="no">alpha</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="no">mean</span>),<span class="kw">digits</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">change</span>),<span class="kw">digits</span><span class="kw">=</span><span class="fl">2</span>)</pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/external.RData"</span>)

<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"clinic"</span>,<span class="st">"omics"</span>,<span class="st">"both"</span>)
<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lasso"</span>,<span class="st">"ridge"</span>)
<span class="no">step</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V04"</span>,<span class="st">"V06"</span>,<span class="st">"V08"</span>)

<span class="co"># percentage change</span>
<span class="no">change</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"meta"</span>,]-<span class="no">x</span>[<span class="st">"base"</span>,])/<span class="no">x</span>[<span class="st">"base"</span>,]))

<span class="co"># overview</span>
<span class="no">vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">table</span>$<span class="no">var1</span>,<span class="no">table</span>$<span class="no">var2</span>))
<span class="no">temp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">NA</span>,<span class="kw">nrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">vars</span>),<span class="kw">ncol</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">vars</span>),<span class="kw">dimnames</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">vars</span>,<span class="no">vars</span>))
<span class="no">array</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">temp</span>),<span class="kw">dim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">3</span>),<span class="kw">dimnames</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">data</span>,<span class="no">alpha</span>,<span class="no">step</span>))
<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_EXT.pdf"</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">7.5</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">10</span>,<span class="kw">pointsize</span><span class="kw">=</span><span class="fl">14</span>)
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>,<span class="fl">3</span>),<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>,<span class="fl">2.5</span>,<span class="fl">2.5</span>,<span class="fl">0.1</span>),<span class="kw">oma</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span>))
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="no">data</span>){
  <span class="kw">for</span>(<span class="no">j</span> <span class="kw">in</span> <span class="no">alpha</span>){
    <span class="kw">for</span>(<span class="no">k</span> <span class="kw">in</span> <span class="no">step</span>){
      <span class="no">cond</span> <span class="kw">&lt;-</span> <span class="no">table</span>$<span class="no">data</span><span class="kw">==</span><span class="no">i</span> <span class="kw">&amp;</span> <span class="no">table</span>$<span class="no">alpha</span><span class="kw">==</span><span class="no">j</span> <span class="kw">&amp;</span> <span class="no">table</span>$<span class="no">step</span><span class="kw">==</span><span class="no">k</span>
      <span class="no">array</span>[<span class="no">i</span>,<span class="no">j</span>,<span class="no">k</span>]<span class="kw">[[</span><span class="fl">1</span>]][<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">table</span>$<span class="no">var1</span>,<span class="no">table</span>$<span class="no">var2</span>)[<span class="no">cond</span>,]] <span class="kw">&lt;-</span> <span class="no">change</span>[<span class="no">cond</span>,<span class="fl">1</span>]
      <span class="no">array</span>[<span class="no">i</span>,<span class="no">j</span>,<span class="no">k</span>]<span class="kw">[[</span><span class="fl">1</span>]][<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">table</span>$<span class="no">var2</span>,<span class="no">table</span>$<span class="no">var1</span>)[<span class="no">cond</span>,]] <span class="kw">&lt;-</span> <span class="no">change</span>[<span class="no">cond</span>,<span class="fl">2</span>]
      <span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="no">array</span>[<span class="no">i</span>,<span class="no">j</span>,<span class="no">k</span>]<span class="kw">[[</span><span class="fl">1</span>]],<span class="kw">margin</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">las</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">20</span>,<span class="fl">20</span>),<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.6</span>)
      <span class="co">#graphics::title(main=paste0(i,"-",j,"-",k),col.main="red",line=0) # check</span>
      <span class="kw">if</span>(<span class="no">i</span><span class="kw">==</span><span class="st">"clinic"</span> <span class="kw">&amp;</span> <span class="no">j</span><span class="kw">==</span><span class="st">"lasso"</span>){<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">k</span><span class="kw">==</span><span class="st">"V04"</span>,<span class="st">"1st"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">k</span><span class="kw">==</span><span class="st">"V06"</span>,<span class="st">"2nd"</span>,<span class="st">"3rd"</span>)),<span class="kw">side</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">line</span><span class="kw">=</span><span class="fl">2.5</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.8</span>)}
      <span class="kw">if</span>(<span class="no">k</span><span class="kw">==</span><span class="st">"V04"</span>){<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">i</span>,<span class="st">"-"</span>,<span class="no">j</span>),<span class="kw">side</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">line</span><span class="kw">=</span><span class="fl">2.5</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.8</span>)}
    }
  }
}
<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()

<span class="co"># check</span>
<span class="no">i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">table</span>)),<span class="kw">size</span><span class="kw">=</span><span class="fl">1</span>)
<span class="no">table</span>[<span class="no">i</span>,]
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">loss</span><span class="kw">[[</span><span class="no">i</span>]]
<span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"meta"</span>,]-<span class="no">x</span>[<span class="st">"base"</span>,])/<span class="no">x</span>[<span class="st">"base"</span>,]</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_ALL.pdf"</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">3</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">6</span>)

<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">0.5</span>))
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span>(<span class="kw">mat</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>),<span class="kw">nrow</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="fl">2</span>),<span class="kw">width</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>,<span class="fl">0.8</span>))
<span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">TEMP</span>),<span class="kw">margin</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">las</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">20</span>,<span class="fl">20</span>),<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.7</span>)

<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">array</span>)<span class="kw">&lt;</span><span class="fl">0</span>,<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">array</span>)))
<span class="no">means</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">array</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>),<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span><span class="kw">[[</span><span class="fl">1</span>]],<span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fl">3</span>),<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">means</span>,<span class="no">x</span>,<span class="no">mean</span>))
<span class="no">mean</span> <span class="kw">&lt;-</span> <span class="fl">1</span>/<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">array</span>)*<span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span>(<span class="kw">f</span><span class="kw">=</span><span class="st">"+"</span>,<span class="kw">x</span><span class="kw">=</span><span class="no">array</span>)
<span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="no">mean</span>,<span class="kw">margin</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">las</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">20</span>,<span class="fl">20</span>),<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.7</span>)
<span class="co"># rows: target variable, columns: coaching variable</span>

<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="kw">file</span><span class="kw">=</span><span class="st">"manuscript/figure_DIF.pdf"</span>,<span class="kw">height</span><span class="kw">=</span><span class="fl">1.2</span>,<span class="kw">width</span><span class="kw">=</span><span class="fl">5</span>)

<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/internal.RData"</span>)
<span class="no">vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">table</span>$<span class="no">var</span>)
<span class="no">base</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"base"</span>,]-<span class="no">x</span>[<span class="st">"none"</span>,])/<span class="no">x</span>[<span class="st">"none"</span>,]))
<span class="no">meta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"meta"</span>,]-<span class="no">x</span>[<span class="st">"none"</span>,])/<span class="no">x</span>[<span class="st">"none"</span>,]))
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">meta</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">base</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">table</span>$<span class="no">var</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1st"</span>,<span class="st">"2nd"</span>,<span class="st">"3rd"</span>))
<span class="no">standard</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">base</span>),<span class="kw">INDEX</span><span class="kw">=</span><span class="no">table</span>$<span class="no">var</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="no">mean</span>)[<span class="no">vars</span>]
<span class="no">internal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">meta</span>),<span class="kw">INDEX</span><span class="kw">=</span><span class="no">table</span>$<span class="no">var</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="no">mean</span>)[<span class="no">vars</span>]

<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"results/external.RData"</span>)
<span class="no">vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">table</span>$<span class="no">var1</span>,<span class="no">table</span>$<span class="no">var2</span>))
<span class="no">base</span> <span class="kw">&lt;-</span> <span class="no">meta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fl">2</span>)){
  <span class="no">base</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"base"</span>,<span class="no">i</span>]-<span class="no">x</span>[<span class="st">"none"</span>,<span class="no">i</span>])/<span class="no">x</span>[<span class="st">"none"</span>,<span class="no">i</span>])
  <span class="no">meta</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">loss</span>,<span class="kw">function</span>(<span class="no">x</span>) <span class="fl">100</span>*(<span class="no">x</span>[<span class="st">"meta"</span>,<span class="no">i</span>]-<span class="no">x</span>[<span class="st">"none"</span>,<span class="no">i</span>])/<span class="no">x</span>[<span class="st">"none"</span>,<span class="no">i</span>])
}
<span class="no">index</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">table</span>$<span class="no">var1</span>,<span class="no">table</span>$<span class="no">var2</span>)
<span class="no">base</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">base</span>); <span class="no">meta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">meta</span>)
<span class="co">#standard &lt;- tapply(X=base,INDEX=index,FUN=mean)[vars]</span>
<span class="no">external</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="no">meta</span>,<span class="kw">INDEX</span><span class="kw">=</span><span class="no">index</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="no">mean</span>)[<span class="no">vars</span>]

<span class="no">matrix</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">standard</span>,<span class="no">internal</span>,<span class="no">external</span>),<span class="kw">digits</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">matrix</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">""</span>,<span class="st">""</span>,<span class="st">""</span>)
<span class="kw pkg">graphics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>),<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">1</span>))
<span class="kw pkg">joinet</span><span class="kw ns">:::</span><span class="fu">plot.matrix</span>(<span class="no">matrix</span>,<span class="kw">margin</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>),<span class="kw">las</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">100</span>,<span class="fl">0</span>),<span class="kw">cex</span><span class="kw">=</span><span class="fl">0.7</span>,<span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)

<span class="kw pkg">grDevices</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://rauschenberger.github.io">Armin Rauschenberger</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
